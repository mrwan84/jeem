// ============================================
// Graph Library Test
// ============================================

import "modules/graph.jm" as graph

print("=== GRAPH LIBRARY TEST ===\n")

// --- Basic Graph Creation ---
print("--- Basic Graph ---")
g = graph.Graph()
graph.addNode(g, "A", null)
graph.addNode(g, "B", null)
graph.addNode(g, "C", null)
graph.addEdge(g, "A", "B", 1)
graph.addEdge(g, "B", "C", 1)
graph.addEdge(g, "A", "C", 1)

print("Nodes:", graph.getNodes(g))
print("Node count:", graph.nodeCount(g))
print("Edge count:", graph.edgeCount(g))
print("Has node A:", graph.hasNode(g, "A"))
print("Has edge A->B:", graph.hasEdge(g, "A", "B"))
print("Neighbors of A:", graph.neighbors(g, "A"))
print("Degree of A:", graph.degree(g, "A"))

// --- Directed Graph ---
print("\n--- Directed Graph ---")
dg = graph.DiGraph()
graph.addEdge(dg, "A", "B", 1)
graph.addEdge(dg, "B", "C", 1)
graph.addEdge(dg, "A", "C", 1)

print("Has edge A->B:", graph.hasEdge(dg, "A", "B"))
print("Has edge B->A:", graph.hasEdge(dg, "B", "A"))
print("Out-degree of A:", graph.outDegree(dg, "A"))
print("In-degree of C:", graph.inDegree(dg, "C"))

// --- Weighted Graph ---
print("\n--- Weighted Graph ---")
wg = graph.WeightedGraph()
graph.addEdge(wg, "A", "B", 5)
graph.addEdge(wg, "B", "C", 3)
graph.addEdge(wg, "A", "C", 10)

print("Weight A->B:", graph.getWeight(wg, "A", "B"))
print("Weight A->C:", graph.getWeight(wg, "A", "C"))

// --- BFS ---
print("\n--- Breadth-First Search ---")
g2 = graph.Graph()
graph.addEdge(g2, 1, 2, 1)
graph.addEdge(g2, 1, 3, 1)
graph.addEdge(g2, 2, 4, 1)
graph.addEdge(g2, 3, 4, 1)
graph.addEdge(g2, 4, 5, 1)

visited = graph.bfs(g2, 1, null)
print("BFS from 1:", visited)

// --- DFS ---
print("\n--- Depth-First Search ---")
visited = graph.dfs(g2, 1, null)
print("DFS from 1:", visited)

visited = graph.dfsIterative(g2, 1, null)
print("DFS iterative from 1:", visited)

// --- Shortest Path (Dijkstra) ---
print("\n--- Dijkstra's Algorithm ---")
wg2 = graph.WeightedGraph()
graph.addEdge(wg2, "A", "B", 4)
graph.addEdge(wg2, "A", "C", 2)
graph.addEdge(wg2, "B", "C", 1)
graph.addEdge(wg2, "B", "D", 5)
graph.addEdge(wg2, "C", "D", 8)
graph.addEdge(wg2, "C", "E", 10)
graph.addEdge(wg2, "D", "E", 2)

path = graph.shortestPath(wg2, "A", "E")
print("Shortest path A->E:", path)
dist = graph.shortestDistance(wg2, "A", "E")
print("Shortest distance A->E:", dist)

// --- Connectivity ---
print("\n--- Connectivity ---")
g3 = graph.Graph()
graph.addEdge(g3, "A", "B", 1)
graph.addEdge(g3, "B", "C", 1)
graph.addEdge(g3, "D", "E", 1)  // Separate component

print("Is connected:", graph.isConnected(g3))
components = graph.connectedComponents(g3)
print("Components:", components)
print("Path exists A->C:", graph.pathExists(g3, "A", "C"))
print("Path exists A->D:", graph.pathExists(g3, "A", "D"))

// --- Cycle Detection ---
print("\n--- Cycle Detection ---")
g4 = graph.Graph()
graph.addEdge(g4, "A", "B", 1)
graph.addEdge(g4, "B", "C", 1)
graph.addEdge(g4, "C", "A", 1)  // Creates cycle
print("Has cycle (undirected):", graph.hasCycle(g4))

dg2 = graph.DiGraph()
graph.addEdge(dg2, "A", "B", 1)
graph.addEdge(dg2, "B", "C", 1)
print("Has cycle (directed, no cycle):", graph.hasCycle(dg2))

graph.addEdge(dg2, "C", "A", 1)  // Creates cycle
print("Has cycle (directed, with cycle):", graph.hasCycle(dg2))

// --- Topological Sort ---
print("\n--- Topological Sort ---")
dag = graph.DiGraph()
graph.addEdge(dag, "A", "B", 1)
graph.addEdge(dag, "A", "C", 1)
graph.addEdge(dag, "B", "D", 1)
graph.addEdge(dag, "C", "D", 1)

sorted = graph.topologicalSort(dag)
print("Topological order:", sorted)

// --- Minimum Spanning Tree ---
print("\n--- Minimum Spanning Tree (Kruskal) ---")
mstGraph = graph.WeightedGraph()
graph.addEdge(mstGraph, "A", "B", 4)
graph.addEdge(mstGraph, "A", "C", 2)
graph.addEdge(mstGraph, "B", "C", 1)
graph.addEdge(mstGraph, "B", "D", 5)
graph.addEdge(mstGraph, "C", "D", 3)

mst = graph.kruskal(mstGraph)
print("MST total weight:", mst.weight)
print("MST edges:")
for e in mst.edges {
    print("  ", e.from, "->", e.to, "weight:", e.weight)
}

// --- From Edge List ---
print("\n--- From Edge List ---")
edges = [["X", "Y", 2], ["Y", "Z", 3], ["X", "Z", 5]]
g5 = graph.fromEdgeList(edges, false)
print("Nodes:", graph.getNodes(g5))
print("Weight X->Y:", graph.getWeight(g5, "X", "Y"))

// --- DOT Format ---
print("\n--- DOT Format ---")
simple = graph.DiGraph()
graph.addEdge(simple, "start", "middle", 1)
graph.addEdge(simple, "middle", "end", 1)
print(graph.toDot(simple, "MyGraph"))

// --- Graph Info ---
print("\n--- Graph Info ---")
graph.printGraph(wg2)

print("\n=== GRAPH LIBRARY TEST COMPLETE ===")
